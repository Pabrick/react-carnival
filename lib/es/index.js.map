{"version":3,"file":"index.js","sources":["../../node_modules/rollup-plugin-styles/dist/runtime/inject-css.js","../../src/Carnival/index.tsx"],"sourcesContent":["var e=[],t=[];function n(n,r){if(n&&\"undefined\"!=typeof document){var a,s=!0===r.prepend?\"prepend\":\"append\",d=!0===r.singleTag,i=\"string\"==typeof r.container?document.querySelector(r.container):document.getElementsByTagName(\"head\")[0];if(d){var u=e.indexOf(i);-1===u&&(u=e.push(i)-1,t[u]={}),a=t[u]&&t[u][s]?t[u][s]:t[u][s]=c()}else a=c();65279===n.charCodeAt(0)&&(n=n.substring(1)),a.styleSheet?a.styleSheet.cssText+=n:a.appendChild(document.createTextNode(n))}function c(){var e=document.createElement(\"style\");if(e.setAttribute(\"type\",\"text/css\"),r.attributes)for(var t=Object.keys(r.attributes),n=0;n<t.length;n++)e.setAttribute(t[n],r.attributes[t[n]]);var a=\"prepend\"===s?\"afterbegin\":\"beforeend\";return i.insertAdjacentElement(a,e),e}}export{n as default};\n","import { useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { AnimationState, CarnivalProps, DirectionState } from './types';\r\nimport './styles.scss';\r\n\r\nconst getRandom = (max: number) => Math.floor(Math.random() * (Math.floor(max) + 1));\r\n\r\nconst Carnival = ({ onSuccess, onFailure, size, duration, random = false }: CarnivalProps) => {\r\n\t// Init component elements position and measures\r\n\tconst barRef = useRef<HTMLInputElement>(null);\r\n\tconst markerRef = useRef<HTMLInputElement>(null);\r\n\tconst [zone, setZone] = useState({ width: 0, left: 0 });\r\n\tconst barWidth = barRef.current?.offsetWidth || 0;\r\n\tconst barHeight = barRef.current?.offsetHeight || 0;\r\n\tconst zoneWidth = (barWidth * size) / 100;\r\n\tconst zoneLeft = useMemo(\r\n\t\t() => (random ? getRandom(barWidth - zoneWidth) : (barWidth - zoneWidth) / 2),\r\n\t\t[random, barWidth, zoneWidth]\r\n\t); // Place 'success Zone' in the middle if random is false\r\n\tuseEffect(() => {\r\n\t\tsetZone({\r\n\t\t\twidth: zoneWidth,\r\n\t\t\tleft: zoneLeft,\r\n\t\t});\r\n\t}, [barRef, zoneWidth, zoneLeft]);\r\n\r\n\t// Controls the direction of the marker\r\n\tconst [direction, setDirection] = useState<DirectionState>('right');\r\n\tconst setMarkerDirection = (percentage: number) => {\r\n\t\tif (percentage >= 100) {\r\n\t\t\tsetDirection('left');\r\n\t\t}\r\n\t\tif (percentage <= 0) {\r\n\t\t\tsetDirection('right');\r\n\t\t}\r\n\t};\r\n\r\n\t// Controls for the animation\r\n\tconst [animation, setAnimation] = useState<AnimationState>('running');\r\n\tconst onMouseDown = () => {\r\n\t\tsetAnimation('paused');\r\n\t\tcheckResult();\r\n\t};\r\n\tconst onMouseUp = () => {\r\n\t\tsetAnimation('running');\r\n\t};\r\n\r\n\t// The animation ifself\r\n\tconst [posX, setPosX] = useState(0);\r\n\tconst requestRef = useRef(0);\r\n\tconst previousTimeRef = useRef(0);\r\n\tconst animate = useCallback(\r\n\t\t(time: number) => {\r\n\t\t\tif (animation === 'running') {\r\n\t\t\t\tconst delta = time - previousTimeRef.current;\r\n\t\t\t\tconst step = (delta * 100) / duration;\r\n\t\t\t\tconst multiplier = direction === 'right' ? 1 : -1;\r\n\t\t\t\tconst newPosition = (position: number) => {\r\n\t\t\t\t\tconst nextPosition = position + step * multiplier;\r\n\t\t\t\t\tlet roundedPosition = Math.round(nextPosition * 100) / 100;\r\n\t\t\t\t\tif (roundedPosition > 100) {\r\n\t\t\t\t\t\troundedPosition = 100;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (roundedPosition < 0) {\r\n\t\t\t\t\t\troundedPosition = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsetMarkerDirection(roundedPosition);\r\n\t\t\t\t\treturn roundedPosition;\r\n\t\t\t\t};\r\n\t\t\t\tsetPosX(newPosition);\r\n\t\t\t}\r\n\t\t\tpreviousTimeRef.current = time;\r\n\t\t\trequestRef.current = requestAnimationFrame(animate);\r\n\t\t},\r\n\t\t[animation, direction, duration]\r\n\t);\r\n\tuseEffect(() => {\r\n\t\trequestRef.current = requestAnimationFrame(animate);\r\n\t\treturn () => cancelAnimationFrame(requestRef.current);\r\n\t}, [animate]);\r\n\r\n\t// Output\r\n\tconst checkResult = () => {\r\n\t\tconst markerX = markerRef.current?.offsetLeft || 0;\r\n\t\tconst startX = zone.left;\r\n\t\tconst endX = zone.left + zone.width;\r\n\t\tif (markerX >= startX && markerX <= endX) {\r\n\t\t\tonSuccess();\r\n\t\t} else {\r\n\t\t\tonFailure();\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<section\r\n\t\t\tclassName='carnival'\r\n\t\t\tdata-testid='carnival'\r\n\t\t\tonMouseDownCapture={onMouseDown}\r\n\t\t\tonMouseUpCapture={onMouseUp}\r\n\t\t>\r\n\t\t\t<div className='carnival__bar' ref={barRef}></div>\r\n\r\n\t\t\t<div\r\n\t\t\t\tclassName='carnival__zone'\r\n\t\t\t\tdata-testid='zone'\r\n\t\t\t\tstyle={{ left: `${zone.left}px`, width: `${zone.width}px` }}\r\n\t\t\t></div>\r\n\r\n\t\t\t<div\r\n\t\t\t\tclassName='carnival__marker'\r\n\t\t\t\tdata-testid='marker'\r\n\t\t\t\tref={markerRef}\r\n\t\t\t\tstyle={{ left: `${posX}%` }}\r\n\t\t\t>\r\n\t\t\t\t<div className='arrow' style={{ borderTopWidth: `${barHeight / 2}px` }}></div>\r\n\t\t\t</div>\r\n\t\t</section>\r\n\t);\r\n};\r\n\r\nexport default Carnival;\r\n"],"names":["e","t","n","r","document","a","s","prepend","d","singleTag","i","container","querySelector","getElementsByTagName","u","indexOf","push","c","charCodeAt","substring","styleSheet","cssText","appendChild","createTextNode","createElement","setAttribute","attributes","Object","keys","length","insertAdjacentElement","Carnival","onSuccess","onFailure","size","duration","random","barRef","useRef","markerRef","zone","setZone","useState","width","left","barWidth","current","offsetWidth","barHeight","offsetHeight","zoneWidth","zoneLeft","useMemo","max","Math","floor","useEffect","direction","setDirection","animation","setAnimation","posX","setPosX","requestRef","previousTimeRef","animate","useCallback","time","step","multiplier","position","nextPosition","roundedPosition","round","percentage","requestAnimationFrame","cancelAnimationFrame","checkResult","markerX","offsetLeft","startX","endX","_jsxs","className","onMouseDownCapture","onMouseUpCapture","children","_jsx","ref","style","borderTopWidth"],"mappings":"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","x_google_ignoreList":[0]}